<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mysl.api.mapper.MediaPlayEventMapper">
    <select id="getEvent" resultType="com.mysl.api.entity.MediaPlayEvent">
        SELECT * FROM media_play_event
        <where>
            !recorded
            <if test="class_course_id != null">
                AND class_course_id = #{class_course_id}
            </if>
            AND media_id = #{media_id}
            AND player_event = #{event}
            AND user_id = #{user_id}
            ORDER BY created_at
            <if test="desc != null">
                desc
            </if>
            LIMIT 1
        </where>
    </select>

    <update id="updateRecorded">
        UPDATE media_play_event
        SET recorded = 1
        <where>
            !recorded
            <if test="class_course_id != null">
                AND class_course_id = #{class_course_id}
            </if>
            AND media_id = #{media_id}
            AND user_id = #{user_id}
        </where>
    </update>
</mapper>
